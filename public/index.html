<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impact Vector</title>
    <script src="./vue.global.js"></script>
    <script src="./axios.min.js"></script>
    <script src="./tailwind.js"></script>
    <script src="./prompt.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-json-pretty@2.2.4/lib/vue-json-pretty.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/vue-json-pretty@2.2.4/lib/styles.css" rel="stylesheet">

<style>
    pre {
      white-space: pre-wrap; /* Preserves whitespace, wraps text */
      word-wrap: break-word; /* Breaks long words to fit container */
      overflow-wrap: break-word; /* Modern alternative to word-wrap */
      max-width: 600px; /* Restrict width to trigger wrapping */
      border: 1px solid #ccc; /* Optional: for visibility */
      padding: 10px;
      font-family: monospace;
    }
  </style>
  
</head>
<body class="bg-gray-50 font-sans antialiased">
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-6 shadow-lg">
            <div class="container mx-auto px-4">
                <h1 class="text-4xl font-extrabold text-center">Impact Vector</h1>
                <p class="text-lg text-center mt-2">Analyze and visualize impact data from your PDF documents</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8 flex-grow">
            <!-- Tabs -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <div class="flex border-b">
                    <button @click="activeTab = 'upload'" :class="{ 'border-b-2 border-blue-500 text-blue-600': activeTab === 'upload', 'text-gray-600': activeTab !== 'upload' }" class="px-4 py-2 font-semibold">Upload</button>
                    <button @click="activeTab = 'prompt'" :class="{ 'border-b-2 border-blue-500 text-blue-600': activeTab === 'prompt', 'text-gray-600': activeTab !== 'prompt' }" class="px-4 py-2 font-semibold">Prompt</button>
                </div>

                <!-- Upload Tab -->
                <div v-if="activeTab === 'upload'" class="mt-6">
                    <h2 class="text-2xl font-semibold mb-4">File Upload</h2>
                    <div class="flex items-center space-x-4">
                        <input type="file" id="pdfInput" @change="handleFileChange" accept=".pdf" class="file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        <button @click="uploadFile" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">Upload</button>
                    </div>
                </div>

                <!-- Prompt Tab -->
                <div v-if="activeTab === 'prompt'" class="mt-6">
                    <h2 class="text-2xl font-semibold mb-4">Custom Prompt</h2>
                    <textarea v-model="prompt" class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="6" placeholder="Enter your custom prompt for PDF analysis..."></textarea>
                </div>
            </div>

            <!-- Results Section -->
            <div v-if="results && results.length" class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-semibold mb-4">Analysis Results</h2>
                <div v-for="(result, index) in results" :key="index" class="border-b py-4">
                    <h3 class="text-lg font-medium">Page {{ index + 1 }}</h3>
                       <pre>{{result}}</pre>
                </div>
            </div>

            <!-- Error Message -->
            <div v-if="errorMessage" class="bg-red-100 text-red-700 p-4 rounded-lg">
                {{ errorMessage }}
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-4">
            <div class="container mx-auto px-4 text-center">
                <p>&copy; 2025 Impact Vector. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            components: {
                VueJsonPretty
            },
            data() {
                return {
                    activeTab: 'upload',
                    file: null,
                    prompt: window.DEFAULT_PROMPT || '',
                    results: null,
                    errorMessage: ''
                };
            },
            methods: {
                handleFileChange(event) {
                    this.file = event.target.files[0];
                },
                async uploadFile() {
                    if (!this.file) {
                        this.errorMessage = 'Please select a file.';
                        return;
                    }

                    const formData = new FormData();
                    formData.append('pdf', this.file);
                    if (this.prompt) {
                        formData.append('prompt', this.prompt);
                    }

                    try {
                        const response = await axios.post('/api/upload', formData, {
                            headers: {
                                'Content-Type': 'multipart/form-data'
                            }
                        });
                        this.results = response.data.results;
                        this.errorMessage = '';
                    } catch (error) {
                        console.error('Error uploading file:', error);
                        this.errorMessage = 'Error uploading file. Please check the console for details.';
                        this.results = null;
                    }
                },
                isJson(result) {
                    return typeof result === 'object' && result !== null;
                },
                formatValue(value) {
                    return value; // Modify if specific formatting is needed
                }
            }
        }).mount('#app');
    </script>
</body>
</html>